<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>C Programming — Full Quiz (Files, Structures, DMA, Strings)</title>
<style>
  :root {
    --bg: #f5f7fb;
    --card: #ffffff;
    --accent: #1366d6;
    --muted: #6b7280;
    --correct: #16a34a;
    --wrong: #dc2626;
    --border: #e6e9ef;
  }
  body{
    font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
    background: var(--bg);
    margin: 0;
    padding: 28px;
    color: #111827;
  }
  header {
    text-align:center;
    margin-bottom: 18px;
  }
  h1 { margin: 0; font-size: 28px; color: var(--accent); }
  p.lead { margin: 6px 0 20px; color: var(--muted); }

  .section {
    background: var(--card);
    border-radius: 10px;
    box-shadow: 0 6px 18px rgba(16,24,40,0.06);
    padding: 18px 20px;
    margin: 18px auto;
    max-width: 1000px;
    border: 1px solid var(--border);
  }
  .section h2 { margin: 0 0 10px 0; font-size: 20px; color: #0f172a; }
  .meta { color: var(--muted); font-size: 13px; margin-bottom: 10px; }

  .question {
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 10px;
    background: linear-gradient(180deg, rgba(243,246,255,0.8), rgba(255,255,255,0.6));
    border: 1px solid rgba(14,165,233,0.04);
  }
  .question p { margin: 0 0 8px 0; font-weight: 600; }
  .opts { margin-left: 8px; }
  label.opt {
    display:block;
    margin: 6px 0;
    padding: 8px 10px;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
    background: white;
    border: 1px solid var(--border);
    transition: background .12s, transform .02s;
    font-weight: 500;
    color:#0f172a;
  }
  label.opt:hover { background:#f1f5ff; transform: translateY(-1px); }
  label.opt.correct { outline: 2px solid rgba(22,163,74,0.12); background: rgba(220,253,230,0.6); }
  label.opt.incorrect { outline: 2px solid rgba(220,38,38,0.12); background: rgba(255,235,238,0.6); }
  .answer-note { font-size: 13px; margin-top: 6px; color: var(--muted); }
  .answer-note strong { color: var(--muted); }

  .controls {
    display:flex;
    gap:10px;
    margin-top: 12px;
    align-items:center;
    flex-wrap:wrap;
  }
  button.btn {
    background: var(--accent);
    color: white;
    border: none;
    padding: 10px 14px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
  }
  button.btn.secondary {
    background: white;
    color: var(--accent);
    border: 1px solid var(--accent);
  }
  .result {
    font-weight:700;
    font-size:15px;
    color: var(--accent);
  }
  .score-badge {
    display:inline-block;
    padding: 6px 10px;
    border-radius: 999px;
    background: rgba(19,102,214,0.08);
    color: var(--accent);
    font-weight:700;
  }

  footer {
    max-width:1000px;
    margin: 20px auto 80px auto;
    text-align: center;
    color:var(--muted);
  }

  /* Final summary */
  .final-summary {
    margin-top: 18px;
    padding: 12px;
    background: linear-gradient(180deg, #ffffff, #fbfdff);
    border-radius: 10px;
    border: 1px solid var(--border);
  }
  .final-row { display:flex; justify-content:space-between; gap:10px; padding:8px 0; border-bottom:1px dashed #eef2ff; }
  .final-row:last-child { border-bottom: none; }
  .final-total { font-size: 18px; font-weight:800; color:var(--accent); }
  @media (max-width:820px){
    .final-row { flex-direction: column; align-items:flex-start; gap:6px; }
  }
</style>
</head>
<body>

<header>
  <h1>C Programming — Full Quiz</h1>
  <p class="lead">Sections: Files • Structures • Dynamic Memory Allocation • Strings & Characters — single scrollable page. Submit each section to reveal correct answers and scores. A final summary at the bottom sums all sections.</p>
</header>

<!-- ================= Section: Files ================= -->
<div class="section" id="section-files">
  <h2>Section A — File Handling in C</h2>
  <p class="meta">Questions given by user (answers will be shown after submitting this section).</p>
  <div id="files-questions"></div>

  <div class="controls">
    <button class="btn" onclick="submitSection('files')">Submit Section</button>
    <button class="btn secondary" onclick="resetSection('files')">Reset Section</button>
    <div id="files-result" class="result" aria-live="polite"></div>
  </div>
</div>

<!-- ================= Section: Structures ================= -->
<div class="section" id="section-structures">
  <h2>Section B — Structures in C</h2>
  <p class="meta">Questions given by user (answers will be shown after submitting this section).</p>
  <div id="structures-questions"></div>

  <div class="controls">
    <button class="btn" onclick="submitSection('structures')">Submit Section</button>
    <button class="btn secondary" onclick="resetSection('structures')">Reset Section</button>
    <div id="structures-result" class="result" aria-live="polite"></div>
  </div>
</div>

<!-- ================= Section: Dynamic Memory Allocation ================= -->
<div class="section" id="section-dma">
  <h2>Section C — Dynamic Memory Allocation (DMA) in C</h2>
  <p class="meta">Questions given by user (answers will be shown after submitting this section).</p>
  <div id="dma-questions"></div>

  <div class="controls">
    <button class="btn" onclick="submitSection('dma')">Submit Section</button>
    <button class="btn secondary" onclick="resetSection('dma')">Reset Section</button>
    <div id="dma-result" class="result" aria-live="polite"></div>
  </div>
</div>

<!-- ================= Section: Strings & Characters ================= -->
<div class="section" id="section-strings">
  <h2>Section D — Strings & Character Handling in C</h2>
  <p class="meta">Questions given by user (answers will be shown after submitting this section).</p>
  <div id="strings-questions"></div>

  <div class="controls">
    <button class="btn" onclick="submitSection('strings')">Submit Section</button>
    <button class="btn secondary" onclick="resetSection('strings')">Reset Section</button>
    <div id="strings-result" class="result" aria-live="polite"></div>
  </div>
</div>

<!-- Final Summary -->
<div class="section">
  <h2>Final Score Summary</h2>
  <div class="final-summary" id="final-summary">
    <div class="final-row">
      <div>Section A — Files</div>
      <div id="final-files" class="score-badge">Not submitted</div>
    </div>
    <div class="final-row">
      <div>Section B — Structures</div>
      <div id="final-structures" class="score-badge">Not submitted</div>
    </div>
    <div class="final-row">
      <div>Section C — Dynamic Memory Allocation</div>
      <div id="final-dma" class="score-badge">Not submitted</div>
    </div>
    <div class="final-row">
      <div>Section D — Strings & Character Handling</div>
      <div id="final-strings" class="score-badge">Not submitted</div>
    </div>

    <div class="final-row" style="margin-top:8px;">
      <div class="final-total">Total Score</div>
      <div id="final-total" class="final-total">—</div>
    </div>
  </div>
</div>

<footer>
  <small>All processing is client-side. Save or print this page if you need a copy.</small>
</footer>

<script>
/*
  All question data below comes from the questions you pasted.
  For each question: { q: "question text", options: [...], answer: <zero-based index of correct option> }
*/

/* ================= Section A — Files ================= */
const filesQuestions = [
  { q: "1. ________ are used for permanent retention of large amounts of data.", options: ["Structures","Arrays","Records","Files"], answer: 3 },

  { q: "2. Which of the following is false?", options: [
      "Storage of data in memory variables is temporary; all such data is lost when a program terminates.",
      "Computers store files on primary storage devices, typically disk storage devices.",
      "Files are used for permanent retention of data (typically large amounts of data).",
      "Storage of data in memory arrays is temporary; all such data is lost when a program terminates."
    ], answer: 1 }, // ANS: (b)

  { q: "3. Which of the following is not a stream associated with C files?", options: ["stdin","stdout","stdchar","stderr"], answer: 2 },

  { q: "4. Which of the following is not part of the FILE structure specified in <stdio.h>?", options: ["file descriptor","open file table","read/write methods","file control block"], answer: 2 },

  { q: "5. C views each file simply as a sequential stream of __________.", options: ["bits","bytes","fields","records"], answer: 1 },

  { q: "6. Which of the following is not automatically opened when a C program begins?", options: ["standard error","standard output","standard dialog","standard input"], answer: 2 },

  { q: "7. __________ provide communication channels between files and programs.", options: ["Streams","Records","File descriptors","File control blocks (FCBs)"], answer: 0 },

  { q: "8. The standard __________ stream enables a program to read data from the keyboard.", options: ["read","keyboard","dialog","input"], answer: 3 },

  { q: "9. Function __________ reads one character from a file.", options: ["fgetcharacter","fgetc","fgetchar","fgetbyte"], answer: 1 },

  { q: "10. Function fputs writes a __________ to a file.", options: ["character","stream","line","standard output"], answer: 2 },

  { q: "11. Which mode would you use if you wanted to open a file for both reading and writing?", options: ["r+","w+","a+","all of these"], answer: 3 },

  { q: "12. If an error occurs while opening a file in any mode, function fopen returns ________.", options: ["true","NULL","false","-1"], answer: 1 },

  { q: "13. Which statement is true?", options: [
      "C imposes no structure on a file.",
      "C imposes record structure on a file.",
      "C imposes sequential access on a file.",
      "C imposes hierarchical access on a file."
    ], answer: 0 },

  { q: "14. Which statement is false?", options: [
      "The programmer must provide any file structure to meet the requirements of each particular application.",
      "A programmer can impose a record structure on a file.",
      "Records must be written to a C file in order by record key.",
      "The notion of a record of a file does not exist in C."
    ], answer: 2 },

  { q: "15. Which of the following statements is false?", options: [
      "The programmer must know the specifics of the FILE structure to use files.",
      "The FILE structure for a file leads indirectly to the operating system’s file control block (FCB) for a file.",
      "If a file does not exist and is opened for writing fopen creates the file.",
      "A C program administers each file with a separate FILE structure."
    ], answer: 0 },

  { q: "16. Before a file can be accessed it must first be", options: ["copied","read","written","opened"], answer: 3 },

  { q: "17. If an existing file is opened for writing __________.", options: [
      "the contents of the file are preserved",
      "the contents of the file are discarded and an error code is returned",
      "the contents of the file are discarded without warning",
      "the newly written data is appended to the end of the file"
    ], answer: 2 },

  { q: "18. Function feof __________.", options: [
      "forces an end-of-file condition",
      "determines whether the end-of-file indicator is set for a file",
      "sets the end-of-file indicator for a file",
      "flushes the contents of the file from the current position to the end"
    ], answer: 1 },

  { q: "19. Which statement is true?", options: [
      "Function fprintf is equivalent to printf.",
      "Function fprintf is equivalent to printf except that fprintf also receives as an argument a file pointer for the file to which the data will be written.",
      "Function fprintf is equivalent to printf except that fprintf also receives as an argument a file control block for the file to which the data will be written.",
      "Function fprintf is equivalent to printf except that fprintf also disables the file end-of-file indicator."
    ], answer: 1 },

  { q: "20. If a file is not closed explicitly by a program __________.", options: [
      "the operating system normally will close the file when program execution terminates",
      "the file will be left open when the program terminates, creating a possible security breach",
      "the operating system will query the user to determine if he or she wishes to close the file when the program terminates",
      "the operating system will not allow the owner of that program to run any other programs"
    ], answer: 0 },

  { q: "21. Which statement is false?", options: [
      "Each file used in a program must have a unique name and will have a different file pointer returned by fopen.",
      "All subsequent file processing functions after the file is opened must refer to the file with the appropriate file control block.",
      "To create a file use file open mode “w”.",
      "To add records to an existing file, pen the file for appending (“a”)."
    ], answer: 1 },

  { q: "22. If an error occurs while opening a file in any mode, fopen __________.", options: [
      "causes program termination",
      "returns NULL",
      "issues the message “can’t open file”",
      "diagnoses the error, waits five minutes and retries"
    ], answer: 1 },

  { q: "23. Which statement is true?", options: [
      "fopen returns a FILE structure.",
      "fopen returns a pointer to a FILE structure.",
      "fopen returns a file control block (FCB).",
      "fopen returns a pointer to a file control block (FCB)."
    ], answer: 1 },

  { q: "24. Function fscanf takes an argument of type ________.", options: ["FILE pointer","cfPtr","char","int"], answer: 0 },

  { q: "25. Which of the following is a function that causes a program’s file position pointer to be repositioned to the beginning of the file?", options: ["rescan","rewind","return","none of these"], answer: 1 },

  { q: "26. Function fscanf is equivalent to function scanf, except that fscanf", options: [
      "can have only a single argument.",
      "can read only from standard streams.",
      "can read only from open streams.",
      "receives as an argument a file pointer for the file from which the data is read."
    ], answer: 3 },

  { q: "27. The rewind statement causes __________.", options: [
      "the disk to stop spinning, then spin in reverse until it repositions to the beginning of the file.",
      "the contents of the file to be erased.",
      "a program’s file position pointer to be repositioned to the beginning of the file (i.e., byte 0).",
      "a file to be closed and then re-opened."
    ], answer: 2 },

  { q: "28. Which statement is true?", options: [
      "The file position pointer is a pointer to a FILE structure.",
      "The file position pointer is a pointer to an FCB.",
      "The file position pointer is not really a pointer.",
      "The file position pointer specifies the file reset."
    ], answer: 2 }
];

/* ================= Section B — Structures ================= */
const structuresQuestions = [
  { q: "1. ________ may contain different data types.", options: ["structures","arrays","both a and b","none of these"], answer: 0 },

  { q: "2. __________ are collections of related variables—sometimes referred to as aggregates—under one name.", options: ["Members","Enumerations","Structures","Files"], answer: 2 },

  { q: "3. Structures may contain variables of many different data types—in contrast to ___________ that contain only elements of the same data type.", options: ["files","arrays","constants","functions"], answer: 1 },

  { q: "4. Two structure variables with the same member values", options: ["always compare equally.","never compare equally.","sometimes compare equally.","only compare equally if both structure variables contain holes."], answer: 2 },

  { q: "5. What does the deck[52] array contain in the following statement? struct card a, deck[52], *cPtr;", options: ["card structure elements","a structure elements","*cPtr elements","none of these"], answer: 0 },

  { q: "6. Keyword __________ introduces the structure definition.", options: ["structure","str","strdef","struct"], answer: 3 },

  { q: "7. A structure containing a member that’s a pointer to the same structure type is referred to as a __________ structure.", options: ["self-referential","self-describing","self-recursive","self- elemental"], answer: 0 },

  { q: "8. Which statement is false?", options: [
      "Structures are derived data types.",
      "Each structure definition must end with a semicolon.",
      "A structure can contain an instance of itself.",
      "Structures may not be compared using operators == and !=."
    ], answer: 2 },

  { q: "9. Which of the following is not a valid operation on a structure?", options: [
      "Assigning structure variables to structure variables of the same type.",
      "Taking the address of a structure variable.",
      "Using the sizeof operator to determine the size of a structure variable.",
      "Comparing structures of the same type with relational operators."
    ], answer: 3 },

  { q: "10. Structure variables may not be initialized by", options: [
      "setting user-defined default variable values in the struct definition.",
      "assigning values to individual data members.",
      "array-like member initializer lists.",
      "assignment statements."
    ], answer: 0 },

  { q: "11. What does the following statement do? struct card a = {\"Three\", \"Hearts\"};", options: [
      "It creates a variable card of type struct with two members specified in the list.",
      "It creates two variables named Three and Hearts of type struct card a.",
      "It creates a variable a to be of type struct card and initializes it to the values in the list.",
      "It creates two variables named Three and Hearts of type struct card."
    ], answer: 2 },

  { q: "12. If there are fewer __________ in the list than members in the structure, the remaining members are automatically initialized to 0 or NULL.", options: ["quantifiers","initializers","numerators","variables"], answer: 1 },

  { q: "13. Structures can be initialized in __________ statements.", options: ["assignment","null","scope","empty"], answer: 0 },

  { q: "14. Arrays are (about passing):", options: [
      "always passed call-by-reference.",
      "passed call-by-reference unless inside a structure.",
      "always passed call-by-value.",
      "passed call-by-value unless inside a structure."
    ], answer: 1 },

  { q: "15. The ________ accesses a structure member via the structure variable name.", options: ["structure member operator","structure pointer operator","structure arrow operator","none of these"], answer: 0 },

  { q: "16. The expression aptr->suit is equivalent to __________.", options: ["aptr.suit","*aptr.suit","(*aptr).suit","*aptr.(suit)"], answer: 2 },

  { q: "17. Which of the following is false?", options: [
      "Structure member names throughout a program must be unique.",
      "Attempting to refer to a member of a structure by using only the member’s name is an error.",
      "Inserting a space between the - and > of operator -> is an error.",
      "The dot operator (.) is the structure member operator."
    ], answer: 0 },

  { q: "18. Structures may be passed to functions by ________.", options: ["passing individual structure members","passing an entire structure","passing a pointer to the structure","all of these"], answer: 3 },

  { q: "19. Arrays of structures ________.", options: ["are automatically passed by reference","are automatically passed by value","cannot be passed by reference","None of the above."], answer: 0 },

  { q: "20. A structure of arrays is automatically passed __________.", options: ["by value","by reference","by aggregate","by masking"], answer: 0 },

  { q: "21. An array of structures is automatically passed __________.", options: ["by value","by reference","by aggregate","by enumeration"], answer: 1 },

  { q: "22. Which of the following is false?", options: [
      "To pass a structure by reference, pass the address of the structure variable.",
      "A way to pass an array by value, is to create a structure with the array as a member then pass the name of the structure.",
      "To pass a structure by reference, pass the name of the structure variable.",
      "Passing large structures by reference is more efficient than passing large structures by value."
    ], answer: 2 },

  { q: "23. typedef is used to", options: [
      "create a name that is an alias for a previously defined data type.",
      "create new data types.",
      "cast one struct to another type.",
      "initialize struct members."
    ], answer: 0 },

  { q: "24. Advantages of typedef do not include", options: [
      "making programs more portable by allowing data types to be easily changed to meet system specifications.",
      "making type names shorter.",
      "making programs more readable.",
      "increasing the efficiency of accessing struct member variables."
    ], answer: 3 },

  { q: "25. Creating a new name with typedef __________.", options: ["creates a new type","creates a new type name","creates a new variable name","creates a new variable"], answer: 1 },

  { q: "26. Which statement is true?", options: [
      "Often, typedef is used to create synonyms for the basic data types.",
      "Keyword typedef is used to create antonyms (or opposites) for the basic data types.",
      "Names for structure types are typically defined with typedef to create longer type names.",
      "The first letter of each typedef name must be capitalized."
    ], answer: 0 },

  { q: "27. What does the statement typedef struct card Card; do?", options: [
      "Defines card as a synonym for Card.",
      "Defines Card as a synonym for card.",
      "Defines Card as a synonym for struct card.",
      "Defines Card as a synonym for typedef struct card."
    ], answer: 2 },

  { q: "28. Which of the following is always a syntax error?", options: [
      "Not using srand in every program that uses rand.",
      "Not using rand in every program that uses srand.",
      "Not using const when passing an array.",
      "Forgetting to include the array subscript when referring to individual structures in an array of structures."
    ], answer: 3 }
];

/* ================= Section C — DMA ================= */
const dmaQuestions = [
  { q: "1. A __________ occurs when dynamically allocated memory is not returned when it’s no longer needed.", options: ["memory leak","self-referential error","allocation error","sizeof error"], answer: 0 },

  { q: "2. __________ memory allocation is the ability for a program to obtain more memory space at execution time and to release space no longer needed.", options: ["Static","Active","Selective","Dynamic"], answer: 3 },

  { q: "3. Function malloc takes as an argument the number of bytes to be allocated, and returns a pointer of type __________ to the allocated memory.", options: ["char *","int *","void *","NULL *"], answer: 2 },

  { q: "4. If no memory is available malloc returns a(n) __________ pointer.", options: ["self","NULL","void","empty"], answer: 1 },

  { q: "5. Not returning dynamically allocated memory when it is no longer needed can cause a system to run out of memory prematurely. This is called a(n) __________.", options: ["outage","memory hole","memory access violation","memory leak"], answer: 3 },

  { q: "6. When memory allocated with malloc is no longer needed, return that memory to the system immediately with __________.", options: ["free_memory","free_storage","return","free"], answer: 3 },

  { q: "7. Which of these is not a common programming error?", options: [
      "Referring to memory that has been freed.",
      "Freeing memory (with free) that was not dynamically allocated.",
      "Assuming that the size of a structure is simply the sum of the sizes of its members.",
      "Calling malloc in a statement without using sizeof."
    ], answer: 3 },

  { q: "8. realloc is conventionally used to", options: [
      "allocate memory for a single object",
      "allocate memory for an array of objects",
      "change the size of an object previously allocated",
      "change the contents of an object previously allocated"
    ], answer: 2 }
];

/* ================= Section D — Strings & Character Handling ================= */
const stringsQuestions = [
  { q: "1. Which of the following is false? (about strings)", options: [
      "A string may include letters, digits, and various special characters (i.e., +, -, * ).",
      "A string in C is an array of characters ending in the null character (‘\\0’).",
      "String literals are written inside of single quotes",
      "A string may be assigned in a definition to either a character array or a variable of type char *."
    ], answer: 2 },

  { q: "2. A character constant is a(n) __________ value represented as a character in single quotes.", options: ["short","int","long","double"], answer: 1 },

  { q: "3. '\\n' represents the integer value of", options: ["the character n","the string n","newline","nextline"], answer: 2 },

  { q: "4. +, \\ and $ are all examples of __________.", options: ["special characters","strings","operators","literals"], answer: 0 },

  { q: "5. A string in C is __________.", options: [
      "an array of characters ending in the empty string",
      "a sequence of characters contained within single quotes",
      "a sequence of characters preceded by a length field",
      "an array of characters ending in the null character"
    ], answer: 3 },

  { q: "6. In C, it is appropriate to say that a string is a(n) __________.", options: ["pointer","integer","double quote","sequence of characters contained in single quotes"], answer: 0 },

  { q: "7. The number 4 typically takes up _________ bit(s) when stored as a character on most of today’s computers.", options: ["1","2","3","8"], answer: 3 },

  { q: "8. The functions of the character-handling library typically manipulate characters as ___________.", options: ["ints.","floats.","longs.","bits."], answer: 0 },

  { q: "9. The isxdigit (is hex digit) function would return false on", options: ["a","A","2","g"], answer: 3 },

  { q: "10. Which character-handling library function returns a true value if its argument is a letter and 0 otherwise?", options: ["isalphanumeric","isalphabetic","isalpha","isletter"], answer: 2 },

  { q: "11. Which character-handling library function converts lowercase letters to uppercase letters?", options: ["lowertoupper","isupper","touppercase","toupper"], answer: 3 },

  { q: "12. Which of the following is not a whitespace character?", options: ["'\\n'","'\\f'","'\\r'","'\\w'"], answer: 3 },

  { q: "13. Which character handling library function returns true if its argument is a printing character?", options: ["ispchar","isprintablechar","isprint","isprintchar"], answer: 2 }
];

/* ----------------- Helper utilities ----------------- */

const sections = {
  files: { questions: filesQuestions, containerId: "files-questions", resultId: "files-result", finalId: "final-files" },
  structures: { questions: structuresQuestions, containerId: "structures-questions", resultId: "structures-result", finalId: "final-structures" },
  dma: { questions: dmaQuestions, containerId: "dma-questions", resultId: "dma-result", finalId: "final-dma" },
  strings: { questions: stringsQuestions, containerId: "strings-questions", resultId: "strings-result", finalId: "final-strings" }
};

const sectionScores = { files: null, structures: null, dma: null, strings: null };

function renderAllSections() {
  Object.keys(sections).forEach(key => {
    renderSection(key);
  });
  updateFinalSummary();
}

function renderSection(key) {
  const s = sections[key];
  const container = document.getElementById(s.containerId);
  container.innerHTML = ""; // clear

  s.questions.forEach((qObj, idx) => {
    const qDiv = document.createElement("div");
    qDiv.className = "question";
    qDiv.id = `${key}-q-${idx}`;
    const qText = document.createElement("p");
    qText.innerHTML = `<span style="color:var(--muted); font-weight:600; margin-right:8px;">${idx+1}.</span> ${escapeHtml(qObj.q)}`;
    qDiv.appendChild(qText);

    const optsDiv = document.createElement("div");
    optsDiv.className = "opts";
    qObj.options.forEach((opt, oidx) => {
      const id = `${key}-q${idx}-opt${oidx}`;
      const label = document.createElement("label");
      label.className = "opt";
      label.htmlFor = id;
      label.innerHTML = `<input type="radio" name="${key}-q-${idx}" id="${id}" value="${oidx}" style="margin-right:8px;"> ${escapeHtml(opt)}`;
      optsDiv.appendChild(label);
    });

    const ansNote = document.createElement("div");
    ansNote.className = "answer-note";
    ansNote.id = `${key}-q-${idx}-note`;
    ansNote.style.display = "none";

    qDiv.appendChild(optsDiv);
    qDiv.appendChild(ansNote);
    container.appendChild(qDiv);
  });
}

/* Escape HTML helper to display characters like < and > safely */
function escapeHtml(text) {
  return text
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");
}

/* Submit a section: reveal correct answers, highlight choices, compute score */
function submitSection(key) {
  const s = sections[key];
  let score = 0;
  s.questions.forEach((qObj, idx) => {
    const qDiv = document.getElementById(`${key}-q-${idx}`);
    const selected = qDiv.querySelector(`input[name="${key}-q-${idx}"]:checked`);
    const labels = Array.from(qDiv.querySelectorAll("label.opt"));
    // Clear any previous classes
    labels.forEach(lb => { lb.classList.remove("correct","incorrect"); });

    // Mark correct option
    const correctIdx = qObj.answer;
    const correctLabel = labels[correctIdx];
    if (correctLabel) correctLabel.classList.add("correct");

    if (selected) {
      const val = parseInt(selected.value, 10);
      if (val === correctIdx) {
        score++;
        // mark selected as correct (already)
      } else {
        // mark selected label incorrect
        const selectedLabel = selected.closest("label.opt");
        if (selectedLabel) selectedLabel.classList.add("incorrect");
      }
    } else {
      // no answer selected - show nothing selected, keep correct highlighted
    }

    // Show answer note (text) under the question
    const note = document.getElementById(`${key}-q-${idx}-note`);
    note.style.display = "block";
    note.innerHTML = `Correct answer: <strong>${escapeHtml(qObj.options[correctIdx])}</strong>`;
  });

  // Save and display section score
  sectionScores[key] = { score: score, total: s.questions.length };
  const resultDiv = document.getElementById(s.resultId);
  resultDiv.textContent = `Score: ${score} / ${s.questions.length}`;
  // Update final summary
  updateFinalSummary();
}

/* Reset a section: clear selections and hide correct answers/highlights */
function resetSection(key) {
  const s = sections[key];
  s.questions.forEach((qObj, idx) => {
    const qDiv = document.getElementById(`${key}-q-${idx}`);
    // uncheck inputs
    const inputs = qDiv.querySelectorAll(`input[name="${key}-q-${idx}"]`);
    inputs.forEach(inp => { inp.checked = false; });
    // clear labels classes
    const labels = qDiv.querySelectorAll("label.opt");
    labels.forEach(lb => { lb.classList.remove("correct","incorrect"); });
    // hide note
    const note = document.getElementById(`${key}-q-${idx}-note`);
    note.style.display = "none";
    note.innerHTML = "";
  });
  // clear saved score
  sectionScores[key] = null;
  document.getElementById(sections[key].resultId).textContent = "";
  updateFinalSummary();
}

function updateFinalSummary() {
  // Update per-section badges
  Object.keys(sections).forEach(k => {
    const el = document.getElementById(sections[k].finalId);
    const sc = sectionScores[k];
    if (!sc) {
      el.textContent = "Not submitted";
    } else {
      el.textContent = `${sc.score} / ${sc.total}`;
    }
  });

  // Compute total if any submitted
  const submitted = Object.values(sectionScores).filter(s => s !== null);
  if (submitted.length === 0) {
    document.getElementById("final-total").textContent = "Not submitted";
    return;
  }
  let totalScore = 0, totalPossible = 0;
  Object.values(sectionScores).forEach(s => {
    if (s) { totalScore += s.score; totalPossible += s.total; }
  });
  document.getElementById("final-total").textContent = `${totalScore} / ${totalPossible} (${((totalScore/totalPossible)*100).toFixed(1)}%)`;
}

/* Render all sections on page load */
renderAllSections();

/* Optional: keyboard-friendly submit on pressing Ctrl+Enter for active section (not necessary but useful) */
document.addEventListener('keydown', (e) => {
  if (e.ctrlKey && e.key === 'Enter') {
    // find first section with unanswered questions to submit
    for (const k of Object.keys(sections)) {
      if (!sectionScores[k]) { submitSection(k); break; }
    }
  }
});
</script>

</body>
</html>
